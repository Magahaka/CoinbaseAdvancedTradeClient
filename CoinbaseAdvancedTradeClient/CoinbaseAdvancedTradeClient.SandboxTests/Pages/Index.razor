@page "/"

@inject IOptionsMonitor<ApiClientConfig> Config

<PageTitle>Index</PageTitle>

<div class="row">
    <div class="col">
        <button class="btn btn-primary" @onclick="@GetListAccountsAsync">GET List Accounts</button>
    </div>
</div>

<div class="row">
    <div class="col">
        <button class="btn btn-primary" @onclick="@GetAccountAsync">GET Account</button>
    </div>
    <div class="col">
        <InputText class="form-control" @bind-Value="@GetAccountId" ></InputText>
    </div>
</div>

@code {

    public ICoinbaseAdvancedTradeApiClient Client { get; private set; }

    public string GetAccountId { get; set; }

    protected override void OnInitialized()
    {
        Client = new CoinbaseAdvancedTradeApiClient(Config.CurrentValue);

        base.OnInitialized();
    }

    public async Task GetListAccountsAsync()
    {
        var limit = 50;

        var responseOne = await Client.Accounts.GetListAccountsAsync(limit);

        await Task.Delay(1);

        var responseTwo = await Client.Accounts.GetListAccountsAsync(limit, responseOne.Data.Cursor);

        await Task.Delay(1);

        var responseThree = await Client.Accounts.GetListAccountsAsync(cursor: responseTwo.Data.Cursor);

        await Task.Delay(1);

        GetAccountId = responseOne.Data.Accounts.First().Id;
    }

    public async Task GetAccountAsync()
    {
        var response = await Client.Accounts.GetAccountAsync(GetAccountId);

        await Task.Delay(1);
    }
}